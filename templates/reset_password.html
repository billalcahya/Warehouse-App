<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" />
    <script src="https://cdn.webix.com/edge/webix.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css"
    />
  </head>
  <body>
    <script>
      webix.ready(function () {
        webix.ui({
          rows: [
            {},
            {
              cols: [
                {},
                {
                  width: 420,
                  rows: [
                    {
                      view: "label",
                      label:
                        "<span style='font-size:48px;color:#667eea;'><span class='mdi mdi-lock-outline'></span></span>",
                      align: "center",
                      height: 60,
                    },
                    {
                      view: "label",
                      label:
                        "<span style='font-size:28px;font-weight:700;color:#667eea;'>Reset Password</span>",
                      align: "center",
                    },
                    {
                      view: "label",
                      label:
                        "<span style='font-size:14px;color:#718096;'>Insert your new password to change the pass</span>",
                      align: "center",
                      height: 30,
                    },
                    {
                      template: `{% with messages = get_flashed_messages(with_categories=true) %}
                            {% for category, message in messages %}
                              <div class="flash-message {{ category }}">{{ message }}</div>
                            {% endfor %}
                          {% endwith %}`,
                      borderless: true,
                      autoheight: true,
                    },

                    {
                      view: "form",
                      id: "resetForm",
                      paddingX: 40,
                      elements: [
                        {
                          view: "text",
                          type: "password",
                          label: "New Password",
                          labelPosition: "top",
                          name: "password",
                          required: true,
                        },
                        {
                          view: "text",
                          type: "password",
                          label: "Confirm Password",
                          labelPosition: "top",
                          name: "confirm_password",
                          required: true,
                        },
                        {
                          view: "button",
                          value: "Change Password",
                          css: "webix_primary",
                          height: 45,
                          click: function () {
                            const form = $$("resetForm");
                            const values = form.getValues();

                            // Validasi di frontend
                            if (values.password !== values.confirm_password) {
                              webix.message({
                                type: "error",
                                text: "Password dan konfirmasi tidak sama.",
                              });
                              return;
                            }

                            if (form.validate()) {
                              const f = document.createElement("form");
                              f.method = "POST";
                              f.action = "/reset_password";

                              const pw = document.createElement("input");
                              pw.name = "password";
                              pw.value = values.password;
                              pw.type = "hidden";

                              const cpw = document.createElement("input");
                              cpw.name = "confirm_password";
                              cpw.value = values.confirm_password;
                              cpw.type = "hidden";

                              const tk = document.createElement("input");
                              tk.name = "token";
                              tk.value = "{{ token }}";
                              tk.type = "hidden";

                              f.appendChild(pw);
                              f.appendChild(cpw);
                              f.appendChild(tk);

                              document.body.appendChild(f);
                              f.submit();
                            }
                          },
                        },
                      ],
                    },
                  ],
                },
                {},
              ],
            },
            {},
          ],
        });
      });
    </script>
  </body>
</html>
